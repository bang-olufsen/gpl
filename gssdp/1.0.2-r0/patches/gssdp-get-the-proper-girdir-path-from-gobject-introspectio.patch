From 802ab3a7b9d267e3adc5a3e4b38069e14e75e8a0 Mon Sep 17 00:00:00 2001
From: Andriy Danylovskyy <andriy.danylovskyy@streamunlimited.com>
Date: Mon, 15 Apr 2019 13:04:24 +0200
Subject: [PATCH] get the proper girdir path from gobject-introspection

Signed-off-by: Andriy Danylovskyy <andriy.danylovskyy@streamunlimited.com>
---
 libgssdp/Makefile.am | 2 +-
 vala/Makefile.am     | 3 +++
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/libgssdp/Makefile.am b/libgssdp/Makefile.am
index 599b20e..c4dd5ba 100644
--- a/libgssdp/Makefile.am
+++ b/libgssdp/Makefile.am
@@ -90,7 +90,7 @@ GSSDP_1_0_gir_NAMESPACE = GSSDP
 GSSDP_1_0_gir_VERSION = 1.0
 INTROSPECTION_GIRS += GSSDP-1.0.gir
 
-girdir = $(datadir)/gir-1.0
+girdir = $$($(PKG_CONFIG) gobject-introspection-1.0 --variable=girdir)
 gir_DATA = GSSDP-1.0.gir
 
 typelibdir = $(libdir)/girepository-1.0
diff --git a/vala/Makefile.am b/vala/Makefile.am
index 6d23189..e438f41 100644
--- a/vala/Makefile.am
+++ b/vala/Makefile.am
@@ -1,5 +1,7 @@
 if HAVE_INTROSPECTION
 if HAVE_VAPIGEN
+GIRDIR = $$($(PKG_CONFIG) gobject-introspection-1.0 --variable=girdir)
+
 gssdp-1.0.vapi: gssdp-1.0.stamp
 	@true
 
@@ -8,6 +10,7 @@ gssdp-1.0.stamp: $(top_builddir)/libgssdp/GSSDP-1.0.gir \
 		$(srcdir)/gssdp-1.0-custom.vala
 	$(AM_V_GEN)$(VAPIGEN) --metadatadir=$(srcdir) \
 			      --library=gssdp-1.0 --pkg=gio-2.0 --pkg=libsoup-2.4 \
+			      --girdir=$(PKG_CONFIG_SYSROOT_DIR)$(GIRDIR) \
 			      $(top_builddir)/libgssdp/GSSDP-1.0.gir \
 				  $(srcdir)/gssdp-1.0-custom.vala && \
 	echo timestmap > $(@F)
-- 
2.7.4

