From aa92740bdabdac43dce4b15e049db451060e01e5 Mon Sep 17 00:00:00 2001
From: Andriy Danylovskyy <andriy.danylovskyy@streamunlimited.com>
Date: Mon, 15 Apr 2019 13:16:43 +0200
Subject: [PATCH] get the proper girdir path from gobject-introspection

Signed-off-by: Andriy Danylovskyy <andriy.danylovskyy@streamunlimited.com>
---
 libgupnp/Makefile.am | 2 +-
 vala/Makefile.am     | 3 +++
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/libgupnp/Makefile.am b/libgupnp/Makefile.am
index e5a9de1..e721bc4 100644
--- a/libgupnp/Makefile.am
+++ b/libgupnp/Makefile.am
@@ -157,7 +157,7 @@ GUPnP_1_0_gir_VERSION = 1.0
 
 INTROSPECTION_GIRS += GUPnP-1.0.gir
 
-girdir = $(datadir)/gir-1.0
+girdir = $$($(PKG_CONFIG) gobject-introspection-1.0 --variable=girdir)
 gir_DATA = GUPnP-1.0.gir
 
 typelibdir = $(libdir)/girepository-1.0/
diff --git a/vala/Makefile.am b/vala/Makefile.am
index d60fdbf..3d4e690 100644
--- a/vala/Makefile.am
+++ b/vala/Makefile.am
@@ -1,5 +1,7 @@
 if HAVE_INTROSPECTION
 if HAVE_VAPIGEN
+GIRDIR = $$($(PKG_CONFIG) gobject-introspection-1.0 --variable=girdir)
+
 gupnp-1.0.vapi: gupnp-1.0.stamp
 	@true
 
@@ -9,6 +11,7 @@ gupnp-1.0.stamp: $(top_builddir)/libgupnp/GUPnP-1.0.gir \
 	$(AM_V_GEN)$(VAPIGEN) --metadatadir=$(srcdir) \
 				  --pkg=libsoup-2.4 \
 			      --library=gupnp-1.0 --pkg=gio-2.0 --pkg=libxml-2.0 \
+			      --girdir=$(PKG_CONFIG_SYSROOT_DIR)$(GIRDIR) \
 			      $(top_builddir)/libgupnp/GUPnP-1.0.gir \
 				  $(srcdir)/gupnp-1.0-custom.vala && \
 	echo timestmap > $(@F)
-- 
2.7.4

